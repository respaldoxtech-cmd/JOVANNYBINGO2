<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yovanny Bingo - Panel de Control</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
</head>
<body class="admin-app">
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- HEADER PRINCIPAL -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <header class="admin-header">
        <div class="header-brand">
            <img src="logo.svg" alt="" class="brand-icon">
            <span class="brand-text">BINGO YOVANNY</span>
            <span class="admin-badge">ADMIN</span>
        </div>
        <div class="header-status">
            <span id="connection-status" class="status-indicator online">üü¢ Conectado</span>
            <span id="players-count" class="players-badge">0 jugadores</span>
        </div>
    </header>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- TICKER DE MENSAJE -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="admin-ticker">
        <input type="text" id="admin-message" placeholder="Mensaje para los jugadores..." maxlength="200">
        <button onclick="setMessage()" class="btn-set">üì¢ Enviar</button>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- √ÅREA PRINCIPAL -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <main class="admin-main">
        <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
             PANEL IZQUIERDO: RULETA Y CONTROLES
        ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
        <section class="panel-left">
            <!-- Ruleta grande -->
            <div class="roulette-box">
                <div class="roulette-display">
                    <div id="roulette-wheel" class="roulette-wheel">
                        <span id="roulette-number" class="roulette-number">--</span>
                    </div>
                    <div class="roulette-stats">
                        <span id="called-count">0</span>/75 n√∫meros
                    </div>
                </div>
                
                <div class="last-balls">
                    <span class="label">√öltimos:</span>
                    <div id="last-numbers" class="balls-row"></div>
                </div>
            </div>

            <!-- Controles de juego -->
            <div class="game-controls">
                <div class="control-group">
                    <input type="number" id="manual-number" min="1" max="75" placeholder="1-75">
                    <button onclick="callNumber()" class="btn-call">üì¢ LLAMAR</button>
                </div>
                
                <div class="control-buttons">
                    <button onclick="undoNumber()" class="btn-undo" title="Deshacer √∫ltimo">‚Ü©Ô∏è Deshacer</button>
                    <button onclick="toggleAuto()" id="auto-btn" class="btn-auto">‚ñ∂Ô∏è Auto</button>
                </div>
            </div>

            <!-- Patr√≥n actual -->
            <div class="pattern-box">
                <h4>üéØ Patr√≥n Actual</h4>
                <div class="pattern-display-large">
                    <div class="pattern-preview-large">
                        <div id="current-pattern-grid" class="large-pattern-grid"></div>
                        <div class="pattern-info">
                            <span id="current-pattern-name" class="pattern-name-large">L√çNEA</span>
                            <span id="current-pattern-desc" class="pattern-desc-small"></span>
                        </div>
                    </div>
                    <button onclick="showPatternSelector()" class="btn-change">Cambiar Patr√≥n</button>
                </div>
            </div>
        </section>

        <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
             PANEL CENTRAL: TABLERO DE N√öMEROS
        ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
        <section class="panel-center">
            <div class="board-header">
                <span class="board-title">Tablero de N√∫meros</span>
                <button onclick="showBoardInfo()" class="btn-info">‚ÑπÔ∏è</button>
            </div>
            <div id="numbers-board" class="numbers-board">
                <!-- Los n√∫meros se generan por JS -->
            </div>
        </section>

        <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
             PANEL DERECHO: JUGADORES Y ACCIONES
        ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
        <section class="panel-right">
            <!-- Tabs -->
            <div class="tabs">
                <button class="tab active" onclick="switchTab('pending')">
                    ‚è≥ Pendientes <span id="pending-badge" class="badge">0</span>
                </button>
                <button class="tab" onclick="switchTab('active')">
                    üë• Activos <span id="active-badge" class="badge">0</span>
                </button>
                <button class="tab" onclick="switchTab('winners')">
                    üèÜ Ganadores
                </button>
            </div>

            <!-- Contenido de tabs -->
            <div id="pending-tab" class="tab-content active">
                <ul id="pending-list" class="player-list">
                    <li class="empty">No hay solicitudes pendientes</li>
                </ul>
            </div>
            
            <div id="active-tab" class="tab-content">
                <ul id="active-list" class="player-list">
                    <li class="empty">No hay jugadores activos</li>
                </ul>
            </div>
            
            <div id="winners-tab" class="tab-content">
                <ul id="winners-list" class="player-list winners">
                    <li class="empty">No hay ganadores a√∫n</li>
                </ul>
            </div>

            <!-- Acciones r√°pidas -->
            <div class="quick-actions">
                <button onclick="showAddPlayerModal()" class="btn-action">‚ûï Agregar Jugador</button>
                <button onclick="showCardStatusModal()" class="btn-action">üé´ Ver Cartones</button>
                <button onclick="newRound()" class="btn-warning">üîÑ Nueva Ronda</button>
                <button onclick="fullReset()" class="btn-danger">‚ö†Ô∏è Reinicio Total</button>
            </div>
        </section>
    </main>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- MODALES -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

    <!-- Modal: Selector de Patr√≥n -->
    <div id="pattern-modal" class="modal hidden">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>üéØ Seleccionar Patr√≥n</h3>
                <button onclick="hideModal('pattern-modal')" class="btn-close">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="patterns-tabs">
                    <button class="pattern-tab active" onclick="showPatternCategory('basic')">B√°sicos</button>
                    <button class="pattern-tab" onclick="showPatternCategory('letters')">Letras</button>
                    <button class="pattern-tab" onclick="showPatternCategory('shapes')">Figuras</button>
                    <button class="pattern-tab" onclick="showPatternCategory('advanced')">Avanzados</button>
                    <button class="pattern-tab" onclick="showPatternCategory('custom')">Personalizado</button>
                </div>
                <div id="patterns-grid" class="patterns-grid"></div>
                <div id="custom-pattern-area" class="custom-pattern hidden">
                    <p>Haz clic para activar/desactivar celdas:</p>
                    <div id="custom-grid" class="custom-grid"></div>
                    <button onclick="applyCustomPattern()" class="btn-primary">Aplicar Patr√≥n Personalizado</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Agregar Jugador -->
    <div id="add-player-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚ûï Agregar Jugador Manual</h3>
                <button onclick="hideModal('add-player-modal')" class="btn-close">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Nombre del jugador</label>
                    <input type="text" id="new-player-name" placeholder="Nombre...">
                </div>
                <div class="form-group">
                    <label>Cartones (separados por coma)</label>
                    <input type="text" id="new-player-cards" placeholder="1, 5, 10...">
                </div>
                <button onclick="addPlayer()" class="btn-primary btn-full">Agregar Jugador</button>
            </div>
        </div>
    </div>

    <!-- Modal: Estado de Cartones -->
    <div id="card-status-modal" class="modal hidden">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>üé´ Estado de Cartones</h3>
                <button onclick="hideModal('card-status-modal')" class="btn-close">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="card-stats">
                    <div class="stat"><span id="stat-available">0</span> Disponibles</div>
                    <div class="stat"><span id="stat-used">0</span> En uso</div>
                </div>
                <div id="cards-grid" class="cards-status-grid"></div>
            </div>
        </div>
    </div>

    <!-- Modal: Ganador Detalle -->
    <div id="winner-detail-modal" class="modal hidden">
        <div class="modal-content modal-winner">
            <div class="winner-header">
                <span class="trophy">üèÜ</span>
                <h2>¬°BINGO!</h2>
            </div>
            <div class="winner-info">
                <h3 id="winner-name">Jugador</h3>
                <p>Cart√≥n <span id="winner-card-id">#00</span></p>
                <p id="winner-pattern">Patr√≥n: L√çNEA</p>
            </div>
            <div id="winner-card-preview" class="card-preview"></div>
            <button onclick="hideModal('winner-detail-modal')" class="btn-primary">Continuar</button>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- JAVASCRIPT -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <script>
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // SISTEMA DE AUDIO ADMIN
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        class AdminAudio {
            constructor() {
                this.ctx = null;
                try {
                    this.ctx = new (window.AudioContext || window.webkitAudioContext)();
                } catch(e) {}
            }
            
            tone(freq, dur, type = 'sine', vol = 0.3) {
                if (!this.ctx) return;
                if (this.ctx.state === 'suspended') this.ctx.resume();
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.frequency.value = freq;
                osc.type = type;
                gain.gain.setValueAtTime(0, this.ctx.currentTime);
                gain.gain.linearRampToValueAtTime(vol, this.ctx.currentTime + 0.01);
                gain.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime + dur);
                osc.start();
                osc.stop(this.ctx.currentTime + dur);
            }
            
            numberCall() {
                this.tone(600, 0.1, 'sawtooth');
                setTimeout(() => this.tone(500, 0.1, 'sawtooth'), 50);
                setTimeout(() => this.tone(400, 0.15, 'sawtooth'), 100);
            }
            
            bingo() {
                this.tone(261.63, 0.8, 'triangle', 0.4);
                setTimeout(() => this.tone(329.63, 0.8, 'triangle', 0.4), 100);
                setTimeout(() => this.tone(392.00, 1.0, 'triangle', 0.4), 200);
            }
            
            newPlayer() {
                this.tone(440, 0.1);
                setTimeout(() => this.tone(554, 0.1), 100);
            }
        }
        
        const audio = new AdminAudio();

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // ESTADO
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        const socket = io();
        let calledNumbers = [];
        let currentPattern = 'line';
        let customGrid = Array(25).fill(false);
        let isAutoPlaying = false;
        let takenCards = new Set();

        // Patrones se cargan desde el servidor (no hardcodeados)
        let PATTERNS = {};
        
        // Categor√≠as para organizar los patrones en el selector
        const PATTERN_CATEGORIES = {
            basic: ['line', 'corners', 'full', 'corners_center', 'small_square'],
            letters: ['letter_t', 'letter_l', 'letter_h', 'letter_o'],
            shapes: ['x_shape', 'plus', 'diamond', 'heart', 'star', 'arrow', 'pyramid', 'cross'],
            advanced: ['frame', 'inner_square', 'hourglass', 'butterfly', 'checkerboard', 'crown', 'snake', 'zigzag']
        };

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // GENERADOR DE CARTONES (igual que servidor)
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function mulberry32(seed) {
            return function() {
                let t = seed += 0x6D2B79F5;
                t = Math.imul(t ^ (t >>> 15), t | 1);
                t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
                return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
            }
        }

        function generateCard(cardId) {
            const rng = mulberry32(cardId);
            const fillCol = (min, max, count) => {
                const nums = new Set();
                let safety = 0;
                while (nums.size < count && safety < 500) {
                    nums.add(Math.floor(rng() * (max - min + 1)) + min);
                    safety++;
                }
                return Array.from(nums);
            };
            const colN = fillCol(31, 45, 4);
            return {
                id: cardId,
                B: fillCol(1, 15, 5),
                I: fillCol(16, 30, 5),
                N: [colN[0], colN[1], "FREE", colN[2], colN[3]],
                G: fillCol(46, 60, 5),
                O: fillCol(61, 75, 5)
            };
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // UI: TABLERO DE N√öMEROS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function initBoard() {
            const board = document.getElementById('numbers-board');
            board.innerHTML = '';
            
            // Headers B I N G O
            ['B', 'I', 'N', 'G', 'O'].forEach(letter => {
                const h = document.createElement('div');
                h.className = 'board-header-cell';
                h.textContent = letter;
                board.appendChild(h);
            });
            
            // N√∫meros 1-75 en columnas
            const ranges = [[1,15], [16,30], [31,45], [46,60], [61,75]];
            for (let row = 0; row < 15; row++) {
                ranges.forEach(([min], colIdx) => {
                    const num = min + row;
                    const cell = document.createElement('div');
                    cell.className = 'board-cell';
                    cell.id = `board-${num}`;
                    cell.textContent = num;
                    cell.onclick = () => callNumberDirect(num);
                    board.appendChild(cell);
                });
            }
        }

        function markBoardNumber(num, marked = true) {
            const cell = document.getElementById(`board-${num}`);
            if (cell) {
                cell.classList.toggle('called', marked);
            }
        }

        function updateRoulette(num) {
            const wheel = document.getElementById('roulette-wheel');
            const display = document.getElementById('roulette-number');
            
            wheel.classList.add('spin');
            display.textContent = num;
            
            setTimeout(() => wheel.classList.remove('spin'), 500);
        }

        function updateLastNumbers(arr) {
            const container = document.getElementById('last-numbers');
            container.innerHTML = arr.map(n => {
                const letter = getLetterForNumber(n);
                return `<div class="ball ${letter.toLowerCase()}">${n}</div>`;
            }).join('');
        }

        function getLetterForNumber(n) {
            if (n <= 15) return 'B';
            if (n <= 30) return 'I';
            if (n <= 45) return 'N';
            if (n <= 60) return 'G';
            return 'O';
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // UI: TABS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            document.querySelector(`[onclick="switchTab('${tab}')"]`).classList.add('active');
            document.getElementById(`${tab}-tab`).classList.add('active');
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // UI: MODALES
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function showModal(id) { document.getElementById(id).classList.remove('hidden'); }
        function hideModal(id) { document.getElementById(id).classList.add('hidden'); }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // SELECTOR DE PATRONES
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function showPatternSelector() {
            showPatternCategory('basic');
            showModal('pattern-modal');
        }

        function showPatternCategory(category) {
            document.querySelectorAll('.pattern-tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`[onclick="showPatternCategory('${category}')"]`).classList.add('active');
            
            const grid = document.getElementById('patterns-grid');
            const customArea = document.getElementById('custom-pattern-area');
            
            if (category === 'custom') {
                grid.classList.add('hidden');
                customArea.classList.remove('hidden');
                initCustomGrid();
            } else {
                customArea.classList.add('hidden');
                grid.classList.remove('hidden');
                
                // Usar categor√≠as predefinidas para filtrar
                const patternIds = PATTERN_CATEGORIES[category] || [];
                const filtered = patternIds
                    .filter(key => PATTERNS[key]) // Solo mostrar si existe en PATTERNS
                    .map(key => [key, PATTERNS[key]]);
                
                grid.innerHTML = filtered.map(([key, pattern]) => `
                    <div class="pattern-option ${currentPattern === key ? 'selected' : ''}" onclick="selectPattern('${key}')">
                        <div class="pattern-mini-grid">${renderMiniGrid(pattern.positions)}</div>
                        <span class="pattern-name">${pattern.name}</span>
                    </div>
                `).join('');
            }
        }

        function renderMiniGrid(positions) {
            let html = '';
            const flatPositions = positions.flat();
            for (let i = 0; i < 25; i++) {
                const isActive = flatPositions.includes(i);
                const isFree = i === 12;
                html += `<div class="mini-cell ${isActive ? 'active' : ''} ${isFree ? 'free' : ''}"></div>`;
            }
            return html;
        }

        function selectPattern(key) {
            currentPattern = key;
            socket.emit('admin_set_pattern', { type: key });
            updatePatternDisplay();
            hideModal('pattern-modal');
        }

        function initCustomGrid() {
            const grid = document.getElementById('custom-grid');
            grid.innerHTML = '';
            customGrid = Array(25).fill(false);
            customGrid[12] = true; // FREE siempre activo
            
            for (let i = 0; i < 25; i++) {
                const cell = document.createElement('div');
                cell.className = `custom-cell ${customGrid[i] ? 'active' : ''} ${i === 12 ? 'free' : ''}`;
                cell.onclick = () => toggleCustomCell(i, cell);
                grid.appendChild(cell);
            }
        }

        function toggleCustomCell(idx, el) {
            if (idx === 12) return; // FREE no se puede desactivar
            customGrid[idx] = !customGrid[idx];
            el.classList.toggle('active');
        }

        function applyCustomPattern() {
            socket.emit('admin_set_pattern', { type: 'custom', grid: customGrid });
            currentPattern = 'custom';
            updatePatternDisplay();
            hideModal('pattern-modal');
        }

        function updatePatternDisplay() {
            const pattern = PATTERNS[currentPattern];
            const nameEl = document.getElementById('current-pattern-name');
            const descEl = document.getElementById('current-pattern-desc');
            
            if (!pattern && currentPattern !== 'custom') {
                console.warn(`‚ö†Ô∏è Patr√≥n "${currentPattern}" no encontrado en PATTERNS. Esperando sincronizaci√≥n...`);
                nameEl.textContent = 'Cargando...';
                descEl.textContent = '';
                return;
            }
            
            nameEl.textContent = pattern?.name || (currentPattern === 'custom' ? 'PERSONALIZADO' : currentPattern);
            descEl.textContent = pattern?.description || '';
            
            const grid = document.getElementById('current-pattern-grid');
            if (currentPattern === 'custom') {
                grid.innerHTML = customGrid.map((active, i) => 
                    `<div class="large-pattern-cell ${active ? 'active' : ''} ${i === 12 ? 'free' : ''}">${i === 12 ? '‚òÖ' : ''}</div>`
                ).join('');
            } else if (pattern && pattern.positions) {
                grid.innerHTML = renderLargeGrid(pattern.positions);
            } else {
                grid.innerHTML = '<div class="pattern-loading">Cargando patr√≥n...</div>';
            }
        }
        
        function renderLargeGrid(positions) {
            let html = '';
            const flatPositions = positions.flat();
            for (let i = 0; i < 25; i++) {
                const isActive = flatPositions.includes(i);
                const isFree = i === 12;
                html += `<div class="large-pattern-cell ${isActive ? 'active' : ''} ${isFree ? 'free' : ''}">${isFree ? '‚òÖ' : ''}</div>`;
            }
            return html;
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // ACCIONES DE JUEGO
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function callNumber() {
            const input = document.getElementById('manual-number');
            const num = parseInt(input.value);
            if (num >= 1 && num <= 75) {
                socket.emit('admin_call_number', num);
                input.value = '';
            }
        }

        function callNumberDirect(num) {
            if (!calledNumbers.includes(num)) {
                socket.emit('admin_call_number', num);
            }
        }

        function undoNumber() {
            socket.emit('admin_undo_number');
        }

        function toggleAuto() {
            if (isAutoPlaying) {
                socket.emit('admin_stop_auto');
            } else {
                socket.emit('admin_start_auto');
            }
        }

        function setMessage() {
            const msg = document.getElementById('admin-message').value.trim();
            if (msg) {
                socket.emit('admin_set_message', msg);
            }
        }

        function newRound() {
            if (confirm('¬øIniciar nueva ronda? Se borrar√°n los n√∫meros llamados.')) {
                socket.emit('admin_reset');
            }
        }

        function fullReset() {
            if (confirm('‚ö†Ô∏è ¬øREINICIO TOTAL? Se eliminar√°n todos los jugadores y datos.')) {
                if (confirm('Esta acci√≥n no se puede deshacer. ¬øContinuar?')) {
                    socket.emit('admin_full_reset');
                }
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // GESTI√ìN DE JUGADORES
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function updatePendingList(players) {
            const list = document.getElementById('pending-list');
            const badge = document.getElementById('pending-badge');
            badge.textContent = players.length;
            
            if (!players.length) {
                list.innerHTML = '<li class="empty">No hay solicitudes pendientes</li>';
                return;
            }
            
            list.innerHTML = players.map(p => `
                <li class="player-item pending">
                    <div class="player-info">
                        <span class="player-name">${p.name}</span>
                        <span class="player-cards">${p.cardCount} cart√≥n(es): #${p.cardIds.join(', #')}</span>
                    </div>
                    <div class="player-actions">
                        <button onclick="acceptPlayer('${p.id}')" class="btn-accept">‚úì</button>
                        <button onclick="rejectPlayer('${p.id}')" class="btn-reject">‚úï</button>
                    </div>
                </li>
            `).join('');
        }

        function updateActiveList(players) {
            const list = document.getElementById('active-list');
            const badge = document.getElementById('active-badge');
            badge.textContent = players.length;
            document.getElementById('players-count').textContent = `${players.length} jugadores`;
            
            if (!players.length) {
                list.innerHTML = '<li class="empty">No hay jugadores activos</li>';
                return;
            }
            
            list.innerHTML = players.map(p => `
                <li class="player-item">
                    <div class="player-info">
                        <span class="player-name">${p.name} <span class="status-badge ${p.status === 'online' ? 'online' : 'offline'}">${p.status === 'online' ? 'üü¢' : '‚ö´'}</span></span>
                        <span class="player-cards">${p.cardCount} cart√≥n(es)</span>
                    </div>
                    <div class="player-actions">
                        <button onclick="kickPlayer(${p.status === 'online' ? `'${p.id}'` : `{username: '${p.name}'}`})" class="btn-kick" title="Eliminar">üö´</button>
                    </div>
                </li>
            `).join('');
        }

        function updateWinnersList(winners) {
            const list = document.getElementById('winners-list');
            if (!winners?.length) {
                list.innerHTML = '<li class="empty">No hay ganadores a√∫n</li>';
                return;
            }
            list.innerHTML = winners.map(w => `
                <li class="winner-item">
                    <span class="winner-icon">üèÜ</span>
                    <span class="winner-name">${w.user}</span>
                    <span class="winner-card">#${w.card}</span>
                    <span class="winner-time">${w.time}</span>
                </li>
            `).join('');
        }

        function acceptPlayer(id) {
            socket.emit('admin_accept_player', id);
            audio.newPlayer();
        }

        function rejectPlayer(id) {
            socket.emit('admin_reject_player', id);
        }

        function kickPlayer(idOrData) {
            const message = typeof idOrData === 'string' ? '¬øExpulsar a este jugador?' : '¬øEliminar a este jugador offline?';
            if (confirm(message)) {
                socket.emit('admin_kick_player', idOrData);
            }
        }

        function showAddPlayerModal() {
            showModal('add-player-modal');
        }

        function addPlayer() {
            const name = document.getElementById('new-player-name').value.trim();
            const cardsInput = document.getElementById('new-player-cards').value;
            
            if (!name) return alert('Ingresa un nombre');
            
            const cardIds = cardsInput.split(',')
                .map(s => parseInt(s.trim()))
                .filter(n => !isNaN(n) && n >= 1 && n <= 300);
            
            if (cardIds.length === 0) return alert('Ingresa cartones v√°lidos');
            
            socket.emit('admin_add_player', { name, cardIds });
            hideModal('add-player-modal');
            document.getElementById('new-player-name').value = '';
            document.getElementById('new-player-cards').value = '';
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // ESTADO DE CARTONES
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function showCardStatusModal() {
            socket.emit('get_card_availability');
            showModal('card-status-modal');
        }

        function updateCardStatus(data) {
            takenCards = new Set(data.takenCards);
            
            document.getElementById('stat-available').textContent = data.availableCount;
            document.getElementById('stat-used').textContent = data.usedCount;
            
            const grid = document.getElementById('cards-grid');
            grid.innerHTML = '';
            
            for (let i = 1; i <= 300; i++) {
                const cell = document.createElement('div');
                cell.className = `card-status-cell ${takenCards.has(i) ? 'taken' : 'available'}`;
                cell.textContent = i;
                cell.title = takenCards.has(i) ? 'En uso' : 'Disponible';
                grid.appendChild(cell);
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // SOCKET EVENTS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        socket.on('connect', () => {
            document.getElementById('connection-status').className = 'status-indicator online';
            document.getElementById('connection-status').innerHTML = 'üü¢ Conectado';
        });

        socket.on('disconnect', () => {
            document.getElementById('connection-status').className = 'status-indicator offline';
            document.getElementById('connection-status').innerHTML = 'üî¥ Desconectado';
        });

        socket.on('sync_state', (state) => {
            calledNumbers = state.calledNumbers;
            currentPattern = state.pattern;
            
            // Sincronizar patrones recibidos del servidor (fuente de verdad)
            if (state.patterns && state.patterns.length > 0) {
                PATTERNS = {}; // Limpiar patrones anteriores
                state.patterns.forEach(p => {
                    PATTERNS[p.id] = {
                        name: p.name,
                        description: p.description || '',
                        positions: p.positions || []
                    };
                });
                console.log('‚úÖ Patrones sincronizados desde servidor:', Object.keys(PATTERNS).length);
            }
            
            document.getElementById('called-count').textContent = calledNumbers.length;
            document.getElementById('admin-message').value = state.message;
            
            calledNumbers.forEach(n => markBoardNumber(n, true));
            updateLastNumbers(state.last5Numbers);
            updateWinnersList(state.last5Winners);
            updatePatternDisplay();
            
            if (state.calledNumbers.length > 0) {
                document.getElementById('roulette-number').textContent = 
                    state.calledNumbers[state.calledNumbers.length - 1];
            }
        });

        socket.on('number_called', (data) => {
            calledNumbers.push(data.num);
            markBoardNumber(data.num, true);
            updateRoulette(data.num);
            updateLastNumbers(data.last5);
            document.getElementById('called-count').textContent = data.totalCalled;
            audio.numberCall();
        });

        socket.on('number_undone', (data) => {
            calledNumbers = data.calledNumbers;
            markBoardNumber(data.number, false);
            updateLastNumbers(data.last5);
            document.getElementById('called-count').textContent = data.totalCalled;
            document.getElementById('roulette-number').textContent = 
                calledNumbers.length > 0 ? calledNumbers[calledNumbers.length - 1] : '--';
        });

        socket.on('pattern_changed', (data) => {
            currentPattern = data.type;
            if (data.grid) {
                customGrid = data.grid;
            }
            // Actualizar PATTERNS con la informaci√≥n recibida del servidor
            if (data.positions !== undefined) {
                if (!PATTERNS[data.type]) {
                    PATTERNS[data.type] = {};
                }
                PATTERNS[data.type].name = data.name;
                PATTERNS[data.type].description = data.description || '';
                PATTERNS[data.type].positions = data.positions;
            }
            updatePatternDisplay();
        });

        socket.on('update_pending_players', updatePendingList);
        socket.on('update_players', updateActiveList);
        socket.on('update_history', updateWinnersList);

        socket.on('new_player_pending', (data) => {
            audio.newPlayer();
            switchTab('pending');
        });

        socket.on('winner_announced', (data) => {
            audio.bingo();
            confetti({ particleCount: 200, spread: 100, origin: { y: 0.6 } });
            
            document.getElementById('winner-name').textContent = data.user;
            document.getElementById('winner-card-id').textContent = `#${data.card}`;
            document.getElementById('winner-pattern').textContent = `Patr√≥n: ${data.patternName || data.pattern}`;
            
            showModal('winner-detail-modal');
        });

        socket.on('winner_card_details', (data) => {
            const preview = document.getElementById('winner-card-preview');
            const card = data.card;
            
            preview.innerHTML = `
                <div class="preview-grid">
                    ${['B','I','N','G','O'].map(l => `<div class="preview-header">${l}</div>`).join('')}
                    ${[0,1,2,3,4].map(row => 
                        ['B','I','N','G','O'].map(col => {
                            const val = card[col][row];
                            const isFree = val === "FREE";
                            const isMarked = isFree || data.calledNumbers.includes(val);
                            return `<div class="preview-cell ${isMarked ? 'marked' : ''}">${isFree ? '‚òÖ' : val}</div>`;
                        }).join('')
                    ).join('')}
                </div>
            `;
        });

        socket.on('auto_play_started', () => {
            isAutoPlaying = true;
            const btn = document.getElementById('auto-btn');
            btn.textContent = '‚èπÔ∏è Detener';
            btn.classList.add('active');
        });

        socket.on('auto_play_stopped', () => {
            isAutoPlaying = false;
            const btn = document.getElementById('auto-btn');
            btn.textContent = '‚ñ∂Ô∏è Auto';
            btn.classList.remove('active');
        });

        socket.on('game_reset', () => {
            calledNumbers = [];
            document.querySelectorAll('.board-cell').forEach(c => c.classList.remove('called'));
            document.getElementById('roulette-number').textContent = '--';
            document.getElementById('called-count').textContent = '0';
            document.getElementById('last-numbers').innerHTML = '';
        });

        socket.on('card_availability', updateCardStatus);

        socket.on('admin_success', (data) => {
            alert(data.message);
        });

        socket.on('admin_error', (data) => {
            alert('Error: ' + data.message);
        });

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // INICIALIZACI√ìN
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        document.addEventListener('DOMContentLoaded', () => {
            initBoard();
            updatePatternDisplay();
            
            document.getElementById('manual-number').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') callNumber();
            });
            
            document.getElementById('admin-message').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') setMessage();
            });
        });
    </script>
</body>
</html>
